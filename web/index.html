<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>Servidor con Sockets en paralelo</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    </head>
    <body>
        <div>Probando WebSocket en Paraleo</div>
        <form>
            Tiempo en Segundos   <input type="text" id="mensaje" value="5"/>
            <input onclick="enviarMensaje();" href="javascript:void(0);" value="Enviar Mensaje" type="button"/><br>
            Mensaje a Flujo   <input type="text" id="flujo" value="Flujo"/><br>
            Mensaje a Celda   <input type="text" id="celda" value="Celda"/><br>
            Mensaje a Ecu     <input type="text" id="ecu" value="Ecu"/><br>
            Mensaje a Encoder <input type="text" id="encoder" value="Encoder"/><br>
        </form>
        <div id="chartContainer" style="height: 370px; width: 100%;"></div>
        <span id="timeToRender"></span>
        <div id="datos"></div>
        <script src="js/canvasjs.min.js"></script>
    </body>
        <script>
            var dat = [];
            var dps = [];
            var inicio;
            var chart;
            var xVal = 1;
            window.onload = function () {
            chart = new CanvasJS.Chart("chartContainer", {
                    title :{
                            text: "Cliente 2"
                    },
                    axisY: {
                            includeZero: false
                    },      
                    data: [{
                            type: "line",
                            dataPoints: dps
                    }]
                });
                
                dps.push({
                            x: 0,
                            y: 0
                    });
                    
                chart.render();
                inicio = 0;
            };

            var fin updateChart = function (inicio,datos) {
                var str = datos;
                var array = str.split(",");

                for (var i=incio;i<array.length;i++){            
                    dps.push({
                            x: i,
                            y: parseFloat(array[i])
                    });
                }
                chart.render();
                fin = inicio + 
                return inicio ;
            };
            var mensaje = document.getElementById('mensaje');          
            var websocket_flujo = new WebSocket("ws://localhost:8080/socket_paralelo/WebsocketFlujo");
            websocket_flujo.onmessage = function Mensaje_flujo(message){
                var flujo = document.getElementById('flujo');
                console.log("Flujo ".concat(message.data));
                flujo.value = message.data;
            };
            
            var websocket_celda = new WebSocket("ws://localhost:8080/socket_paralelo/WebsocketCelda");     
            websocket_celda.onmessage = function Mensaje_celda(message2){
                var celda = document.getElementById('celda');
                console.log("Celda ".concat(message2.data));
                celda.value = message2.data;
            };
            
            var websocket_ecu = new WebSocket("ws://localhost:8080/socket_paralelo/WebsocketECU");
            websocket_ecu.onmessage = function Mensaje_ecu(message3){
                var ecu = document.getElementById('ecu');
                console.log("Ecu ".concat(message3.data));
                ecu.value = message3.data;
            };  
            
            var websocket_encoder = new WebSocket("ws://localhost:8080/socket_paralelo/WebsocketEncoder");      
            websocket_encoder.onmessage = function Mensaje_encoder(message4){
                var encoder = document.getElementById('encoder');
                console.log("Encoder ".concat(message4.data));               
                updateChart(message4.data);
            };
               
            function enviarMensaje(){
                var msj = mensaje.value;
                for (var i=0;i<100;i++){
                    dat.push(9*Math.sin(i*0.07));
                }
                var aux = dat.toString();
                websocket_encoder.send(aux); 
            };
            
        </script>
    
</html>
