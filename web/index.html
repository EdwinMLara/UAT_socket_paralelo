<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>Servidor con Sockets en paralelo</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    </head>
    <body>
        <div>Probando WebSocket en Paraleo</div>
        <form>
            Tiempo en Segundos   <input type="text" id="mensaje" value="5"/>
            <input onclick="enviarMensaje();" value="Enviar Mensaje" type="button"/><br>
            Mensaje a Flujo   <input type="text" id="re" value=""/><br>
            Mensaje a Celda   <input type="text" id="re2" value=""/><br>
            Mensaje a Ecu     <input type="text" id="re3" value=""/><br>
            Mensaje a Encoder <input type="text" id="re4" value=""/><br>
        </form>
        <div id="chartContainer" style="height: 370px; width: 100%;"></div>
        <span id="timeToRender"></span>
        <script src="js/canvasjs.min.js"></script>
    </body>
        <script>
            var dps = []; 
            var chart;
            var xVal = 1;
            window.onload = function () {
            chart = new CanvasJS.Chart("chartContainer", {
                    title :{
                            text: "Cliente 2"
                    },
                    axisY: {
                            includeZero: false
                    },      
                    data: [{
                            type: "line",
                            dataPoints: dps
                    }]
                });
                updateChart(xVal,0);
            };

            var updateChart = function (xVal,yVal) {

                            yVal = yVal +  Math.sin(Math.PI*xVal);
                            dps.push({
                                    x: xVal,
                                    y: yVal
                            });
                            xVal++;

                    chart.render();
                    return xVal;
            };
        
            var websocket4 = new WebSocket("ws://localhost:8080/socket_paralelo/WebsocketEncoder");
            var websocket3 = new WebSocket("ws://localhost:8080/socket_paralelo/WebsocketECU");
            var websocket2 = new WebSocket("ws://localhost:8080/socket_paralelo/WebsocketCelda");
            var websocket = new WebSocket("ws://localhost:8080/socket_paralelo/WebsocketFlujo");
    
            var mensaje = document.getElementById('mensaje');
            var msjEnviar = document.getElementById('re');
            var msjEnviar2 = document.getElementById('re2');
            var msjEnviar3 = document.getElementById('re3');
            var msjEnviar4 = document.getElementById('re4');
            
            
            
            websocket.onmessage = function processMessage(message){
                msjEnviar.value = message.data;
            };
            
            websocket2.onmessage = function processMessage2(message2){
                msjEnviar2.value = message2.data;
            };
            
            websocket3.onmessage = function processMessage3(message3){
                msjEnviar3.value = message3.data;
            };
            
            websocket4.onmessage = function processMessage4(message4){
                msjEnviar4.value = message4.data;
            };
           
            function enviarMensaje(){
                var text = "Iniciar:";
                var tiempo = mensaje.value;
                var msj = text.concat(tiempo);
                //msjEnviar2.value = msj;
                websocket4.send(msj);
                websocket3.send(msj);
                websocket2.send(msj);
                websocket.send(msj);
            };
            
        </script>
    
</html>
